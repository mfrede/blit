@echo off

REM ===================================================================================================
REM Written by MJ Frederickson
REM Designed to produce a text file with critical system information.  Does NOT rely on external tools.
REM Can be a jumping off point for finding additional information - or at least knowing what direction
REM to go.
REM ===================================================================================================

REM ====================================
REM Set variables
REM ====================================
set hostname=%computername%

REM - Get date info for file name
set thisdate=%date%
for /f "tokens=2-4 delims=/ " %%d in ('date /t') do (
    set day=%%d
    set month=%%e
    set year=%%f
)

REM Get time info for file name
for /f "tokens=1-3 delims=: " %%a in ('time /t') do (
    set hours=%%a
    set minutes=%%b
    set seconds=%%c
)
set outfile=%hostname%_%year%.%month%.%day%_%hours%.%minutes%.%seconds%.txt

REM ====================================
REM File header - set hostname
REM ====================================
echo =============================================================================================================================== > %outfile%
echo === HOSTNAME: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
hostname >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Write version information to file
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === VERSION INFORMATION: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
ver >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Store date and time
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === DATE AND TIME: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
date /t >> %outfile%
time /t >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Write system information to file
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === SYSTEM INFORMATION: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
systeminfo >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM BCDEDIT - Boot Configuration Data Store Editor
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === BCDEDIT - Boot Configuration Data: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
bcdedit /enum /v >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM DRIVERQUERY - Get current driver information
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === DRIVERQUERY - Driver Information: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
driverquery >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM GPRESULT - Display Group Policy Information
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === GPRESULT - Display Group Policy Information: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
gpresult /r /v >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM OPENFILES - Display Open Files
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === OPENFILES - Display Open Files: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
openfiles >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Services
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === SERVICES: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
sc query >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Tree
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === TREE of System Drive: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
tree c: >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM NET Information
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === NET Commands: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo ACCOUNTS:
net accounts >> %outfile%
echo LOCAL GROUPS:
net localgroup >> %outfile%
echo ADMINISTRATOR GROUP:
net localgroup administrators >> %outfile%
echo USERS:
net users >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM NETWORK Information
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === NETWORK Information: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo STATISTICS:
netstat -e >> %outfile%
echo CONNECTIONS:
netstat -naob >> %outfile%
echo ROUTING INFORMATION:
netstat -r >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM REGISTRY INFORMATION - STARTUP PROGRAMS
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === REGISTRY Information - Startup Programs: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run >> %outfile%
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Runonce >> %outfile%
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunonceEx >> %outfile%
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run >> %outfile%
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Runonce >> %outfile%
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunonceEx >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Scheduled Tasks
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === SCHEDULED TASKS: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
schtasks >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Active Tasks
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === ACTIVE TASKS: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
tasklist /v >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM STARTUP Tasks
REM ====================================
echo =============================================================================================================================== >> %outfile%
echo === WMIC Startup Tasks: %hostname% ===  >> %outfile%
echo =============================================================================================================================== >> %outfile%
wmic startup list full >> %outfile%
echo =============================================================================================================================== >> %outfile%
echo/ >> %outfile%

REM ====================================
REM Output for flow - how are we doing
REM ====================================
echo Outfile is %outfile%



